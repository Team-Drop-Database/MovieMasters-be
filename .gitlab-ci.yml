stages:
  - build
  - test
  - pull_project

build-job:
  stage: build
  image: gradle:jdk21
  tags:
    - hva
  script: ./gradlew build -x test

test-job:
  stage: test
  image: gradle:jdk21
  tags:
    - hva
  script: ./gradlew --build-cache test

pull_project_job:
  stage: pull_project
  image: ubuntu:latest
  tags:
    - hva
  variables:
    PORT: 2222
  before_script:
    - 'command -v ssh-agent >/dev/null || ( apt-get update -y && apt-get install openssh-client -y )'
    - eval $(ssh-agent -s)
    - chmod 400 $SSH_PRIVATE_KEY
  script: 
    - ssh -o StrictHostKeyChecking=no -i $SSH_PRIVATE_KEY $SSH_USERNAME@$SSH_HOST -p 2222 "
        cd app/backend && git pull
        "
